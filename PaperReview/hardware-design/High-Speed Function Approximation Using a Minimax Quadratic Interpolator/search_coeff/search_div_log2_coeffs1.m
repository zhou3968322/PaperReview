
% this script is to compute log2 without variant multiplication correction.
f = @(x) log2_div_approx(x);
m = 6;
table_size = 2^m;

% r = 24; 
% delta = 2^(-r-2);
% error_limit = 2^(-r-1);
% error_approx = 2^(-25) + 2^(-26);
% final error < 2^(-25) + 2^(-26) + 2^(-26) = 2^(-24)
error_approx = 2^(-24) + 2^(-25);
% 希望最终的误差 < error_limit = 2^(-25)
% 估计的每一项的误差应该 < 2^(-25)
t_range = [28, 27, 26, 25];

% p * 2^{-m}, p error is more than 18 bit.
p_range = [20, 19, 18, 17, 16, 15, 14, 13];

% q * 2^{-2m}, q error is less than 12 bit.
q_range = [13, 12, 11, 10, 9];

max_table_bits = 0;

results = struct('t', {}, 'p', {}, 'q', {}, 'coeff_size', {}, 'max_error', {});


for p = p_range
    for t = t_range
        for q = q_range
            [approx, int_approx, normr, max_error, success] = computecoeffs1(f, t, p, q, table_size, error_approx);
            if success
                coeff_size = p + t + q;
                results(end+1) = struct('t', t, 'p', p, 'q', q, 'coeff_size', coeff_size, 'max_error', max_error);
            end
        end
    end
end

resultsTable = struct2table(results);
sortedResults = sortrows(resultsTable, 'coeff_size');

% Display or process the sorted results
disp(sortedResults);
%       final compute result is 
    % t     p     q     coeff_size    max_error 
    % __    __    __    __________    __________
    % 
    % 25    15    11        51         8.804e-08
    % 25    16    11        52        6.8575e-08
    % 26    15    11        52         8.804e-08
    % 25    15    12        52        8.7201e-08
    % 25    17    11        53        5.8954e-08
    % 26    16    11        53        6.8575e-08
    % 25    16    12        53        6.4467e-08
    % 27    15    11        53         8.804e-08
    % 26    15    12        53        8.7201e-08
    % 25    15    13        53        8.7199e-08
    % 25    18    11        54        5.8954e-08
    % 26    17    11        54        5.8954e-08
    % 25    17    12        54        5.7351e-08
    % 27    16    11        54        6.8575e-08
    % 26    16    12        54        6.4467e-08
    % 25    16    13        54        6.4467e-08
    % 28    15    11        54         8.804e-08
    % 27    15    12        54        8.7201e-08
    % 26    15    13        54        8.7199e-08
    % 25    20    10        55        8.7371e-08
    % 25    19    11        55        6.5115e-08
    % 26    18    11        55        5.8954e-08
    % 25    18    12        55        5.5846e-08
    % 27    17    11        55        5.8954e-08
    % 26    17    12        55        5.7351e-08
    % 25    17    13        55        4.9446e-08
    % 28    16    11        55        6.8575e-08
    % 27    16    12        55        6.4467e-08
    % 26    16    13        55        6.4467e-08
    % 28    15    12        55        8.7201e-08
    % 27    15    13        55        8.7199e-08
    % 26    20    10        56        8.7371e-08
    % 25    20    11        56        6.5115e-08
    % 26    19    11        56        6.5115e-08
    % 25    19    12        56        4.8514e-08
    % 27    18    11        56        5.8954e-08
    % 26    18    12        56        5.5846e-08
    % 25    18    13        56        4.7733e-08
    % 28    17    11        56        5.8954e-08
    % 27    17    12        56        5.7351e-08
    % 26    17    13        56        4.9446e-08
    % 28    16    12        56        6.4467e-08
    % 27    16    13        56        6.4467e-08
    % 28    15    13        56        8.7199e-08
    % 27    20    10        57        8.7371e-08
    % 26    20    11        57        6.5115e-08
    % 25    20    12        57        5.1504e-08
    % 27    19    11        57        6.5115e-08
    % 26    19    12        57        4.8514e-08
    % 25    19    13        57        4.7524e-08
    % 28    18    11        57        5.8954e-08
    % 27    18    12        57        5.5846e-08
    % 26    18    13        57        4.7733e-08
    % 28    17    12        57        5.7351e-08
    % 27    17    13        57        4.9446e-08
    % 28    16    13        57        6.4467e-08
    % 28    20    10        58        8.7371e-08
    % 27    20    11        58        6.5115e-08
    % 26    20    12        58        5.1504e-08
    % 25    20    13        58        4.7524e-08
    % 28    19    11        58        6.5115e-08
    % 27    19    12        58        4.8514e-08
    % 26    19    13        58        4.7524e-08
    % 28    18    12        58        5.5846e-08
    % 27    18    13        58        4.7733e-08
    % 28    17    13        58        4.9446e-08
    % 28    20    11        59        6.5115e-08
    % 27    20    12        59        5.1504e-08
    % 26    20    13        59        4.7524e-08
    % 28    19    12        59        4.8514e-08
    % 27    19    13        59        4.7524e-08
    % 28    18    13        59        4.7733e-08
    % 28    20    12        60        5.1504e-08
    % 27    20    13        60        4.7524e-08
    % 28    19    13        60        4.7524e-08
    % 28    20    13        61        4.7524e-08

